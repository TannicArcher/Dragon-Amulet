<?php

if ( $flag )
{
		$stmp =
				'У кого в руках флаг лидерства, тот получает +10 к жизни, +20% к шансу произнести заклинание и +10% к шансу выполнить прием. Флаг лидерства единственный на сервере, его местоположение показывается на карте. Нападение на несущего не считается преступлением (даже в городе!). Флаг падает на землю после смерти и при уходе в оффлайн.';
		$stmp .= '<br/><br/><anchor>[Назад]<prev/></anchor>';
		msg( $stmp );
}
if ( $info )
{
		$stmp =
				'<p>Ваша позиция обозначена белым квадратиком с черной точкой в центре (или черным квадратиком с белой точкой в центре, в зависимости от фона).<br/>Флаг лидерства - для цветных желтым квадратиком с черной точкой, для ч/б - как ваша.<br/>Замки - красные квадратики с белой точкой в центре (только для цветной карты).<br/>В настройках можете поменять тип карты (формат PNG лучший, но не все телефоны поддерживают).';
		$stmp .= '<br/><br/><anchor>[Назад]<prev/></anchor>';
		msg( $stmp );
}
function calctc( $loc )
{
		if ( $loc == "_begin" )
				$loc = "x1158x523";
		if ( $loc == "arena" )
				$loc = "x1086x501";
		if ( substr( $loc, 0, 4 ) == "c.1." )
				$loc = "x1429x168";
		if ( substr( $loc, 0, 4 ) == "c.2." )
				$loc = "x781x429";
		if ( substr( $loc, 0, 4 ) == "c.3." )
				$loc = "x1129x369";
		if ( substr( $loc, 0, 4 ) == "c.4." )
				$loc = "x2320x348";

		$tc = explode( "x", $loc );
		if ( $tc[2] > 1101 )
		{
				$tc[1] = round( ( $tc[1] - 20 ) / 6 );
				$tc[2] = round( ( $tc[2] - 1101 ) / 6 );
				$tc[3] = 2;
		}
		else
				if ( $tc[1] > 1650 )
				{
						$tc[1] = round( ( $tc[1] - 450 - 1200 ) / 15 );
						$tc[2] = round( $tc[2] / 15 );
						$tc[3] = 1;
				}
				else
				{
						$tc[1] = round( ( $tc[1] - 450 ) / 12 );
						$tc[2] = round( $tc[2] / 12 );
						$tc[3] = 0;
				}
				return $tc;
}

$tc = calctc( $l );
$tcf = calctc( $f );

$stmp = '<p><img alt="map" src="m.php?l=' . $loc . '&amp;f=' . $game["floc"] . '&amp;img=1&amp;r=' . rand( 99, 999 ) . '&amp;bw=' . $map . '" /></p>';
$stmp .= "<p>Вы на ";
if ( $tc[3] == 2 )
		$stmp .= "Волчьем острове.";
else
		if ( $tc[3] )
				$stmp .= "территории Ансалона.";
		else
				$stmp .= "основной территории.";
if ( !$game["floc"] )
		$fc = "неизвестно у кого (попробуйте обновить карту) ";
else
		if ( $game["fid"] )
				$fc = "у " . $game["fchar"] . " ";
		else
				$fc = "сейчас никому не принадлежит ";
$stmp .= '<br/>Флаг лидерства [<a href="g.php?sid=' . $sid . '&amp;map=' . $map . '&amp;flag=1">?</a>] ' . $fc;
if ( $tcf[3] != $tc[3] )
{
		$stmp .= "на ";
		if ( $tc[3] == 2 )
				$stmp .= "Волчьем острове.";
		else
				if ( $tcf[3] )
						$stmp .= "территории Ансалона.";
				else
						$stmp .= "основной территории.";
}
$stmp .= '<br/><a href="g.php?sid=' . $sid . '&amp;map=' . $map . '&amp;info=1">Помощь</a>';

msg( $stmp );

?>